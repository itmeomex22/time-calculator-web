<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏ß‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid black; padding: 5px; text-align: center; }
        button { margin: 5px; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>‡∏ö‡∏ß‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</h2>
    <form id="timeForm">
        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</label>
        <select id="location">
            <option value="‡∏õ‡∏±‡πâ‡∏°‡∏ö‡∏ô">‡∏õ‡∏±‡πâ‡∏°‡∏ö‡∏ô</option>
            <option value="‡∏õ‡∏±‡πâ‡∏°‡∏´‡∏≠‡∏¢">‡∏õ‡∏±‡πâ‡∏°‡∏´‡∏≠‡∏¢</option>
            <option value="‡∏≠‡∏π‡πà">‡∏≠‡∏π‡πà</option>
            <option value="‡∏Å‡∏•‡∏≤‡∏á">‡∏Å‡∏•‡∏≤‡∏á</option>
            <option value="DG">DG</option>
            <option value="‡∏°‡∏∑‡∏≠ 2">‡∏°‡∏∑‡∏≠ 2</option>
        </select>
        <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</label>
        <input type="text" id="current_time" readonly>
        <label>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ.‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ):</label>
        <input type="text" id="add_time" placeholder="20 ‡∏´‡∏£‡∏∑‡∏≠ 20.30" required>
        <button type="submit">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
    </form>

    <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h3>
    <table>
        <thead>
            <tr>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏ß‡∏Å</th>
                <th>‡∏•‡∏ö</th>
            </tr>
        </thead>
        <tbody id="historyTable"></tbody>
    </table>
    <button id="resetHistory">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
    <button id="downloadExcel">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel</button>

    <script>
        const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1354111719584174090/0vHrfXCbUisYYYojMVlen3_PQg4EIh63eXPcJBa9gRp63cWZoL5NNdhIlld1P0YVCui5"; // üîó ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Webhook ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà

        function updateCurrentTime() {
            let now = new Date();
            document.getElementById("current_time").value = formatTime(now);
        }
        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();

        document.getElementById("timeForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let add_time = document.getElementById("add_time").value.split(".");
            let add_minutes = parseInt(add_time[0]) || 0;
            let add_seconds = add_time[1] ? parseInt(add_time[1]) : 0;
            let location = document.getElementById("location").value;

            let now = new Date();
            now.setMinutes(now.getMinutes() + add_minutes);
            now.setSeconds(now.getSeconds() + add_seconds);
            let new_time = formatTime(now);
            let current_time = document.getElementById("current_time").value;

            let history = JSON.parse(localStorage.getItem("history")) || [];
            history.push({ location, current_time, new_time });
            history.sort((a, b) => a.new_time.localeCompare(b.new_time)); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
            localStorage.setItem("history", JSON.stringify(history));

            updateHistory();

            // üìå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Discord
            let message = {
                content: `üì¢ **‡∏ö‡∏ß‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà!**\nüìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${location}\n‚è≥ ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${current_time}\n‚è© ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏ß‡∏Å: ${new_time}`
            };

            fetch(DISCORD_WEBHOOK_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(message)
            }).then(res => console.log("‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Discord ‡πÅ‡∏•‡πâ‡∏ß!"));
        });

        function formatTime(date) {
            let hours = String(date.getHours()).padStart(2, '0');
            let minutes = String(date.getMinutes()).padStart(2, '0');
            let seconds = String(date.getSeconds()).padStart(2, '0');
            return `${hours}.${minutes}.${seconds}`;
        }

        function updateHistory() {
            let historyTable = document.getElementById("historyTable");
            historyTable.innerHTML = "";
            let history = JSON.parse(localStorage.getItem("history")) || [];
            history.forEach((item, index) => {
                let row = `<tr>
                    <td>${item.location}</td>
                    <td>${item.current_time}</td>
                    <td>${item.new_time}</td>
                    <td><button onclick="deleteRow(${index})">‡∏•‡∏ö</button></td>
                </tr>`;
                historyTable.innerHTML += row;
            });
        }

        function deleteRow(index) {
            let history = JSON.parse(localStorage.getItem("history")) || [];
            history.splice(index, 1);
            localStorage.setItem("history", JSON.stringify(history));
            updateHistory();
        }

        document.getElementById("resetHistory").addEventListener("click", function() {
            localStorage.removeItem("history");
            updateHistory();
        });

        document.getElementById("downloadExcel").addEventListener("click", function() {
            let history = JSON.parse(localStorage.getItem("history")) || [];
            let data = [["‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà", "‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô", "‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏ß‡∏Å"]];
            history.forEach(item => data.push([item.location, item.current_time, item.new_time]));

            let ws = XLSX.utils.aoa_to_sheet(data);
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥");
            XLSX.writeFile(wb, "history.xlsx");
        });

        updateHistory();
    </script>
</body>
</html>
